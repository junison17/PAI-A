import streamlit as st
import openai

# OpenAI API 키를 Streamlit secrets에서 설정
openai.api_key = st.secrets["OPENAI_API_KEY"]

# PAI-A 질문 리스트 (264개의 질문)
questions = [
    "나는 내적 갈등 때문에 어려움을 겪고 있다.",
    "사물이 이중으로 보이거나 흐릿하게 보인 적이 있다.",
    "신경이 예민해서 일을 잘 할 수 없다.",
    "물건이 제자리에 있지 않으면 신경 쓰인다.",
    "아무 이유 없이 슬퍼질 때가 많다.",
    "내 말과 생각이 너무 빨라서 다른 사람들이 이해하지 못하는 경우가 많다.",
    "나는 사람들이 솔직하다고 생각한다.",
    "나는 다른 사람이 들으면 이상하다고 여길만한 생각들을 하고 있다.",
    "법에 저촉되는 일을 저지른 적이 있다.",
    "여러 가지 복잡한 건강 문제가 있다.",
    "내가 화가 나서 소리를 지르면 사람들이 많이 놀랄 것이다.",
    "신경이 예민해서 집중하기 어려울 때가 많다.",
    "불행할 수밖에 없는 운명을 타고났다.",
    "본의 아니게 실수나 실언을 할까봐 두려울 때가 가끔 있다.",
    "나 자신이 무가치한 존재라는 생각이 들 때가 있다.",
    "나는 매우 사교적인 사람이다.",
    "나는 거의 술을 마시지 않는 편이다.",
    "음주는 원만한 사회생활에 도움이 된다.",
    "나는 다른 사람들에게는 없는 매우 특별한 재능을 가지고 있다.",
    "기분이 좋아지게 하려고 약물을 사용할 때가 있다.",
    "아무리 생각해도 계속 살아야 할 이유를 찾을 수가 없다.",
    "고의적으로 나를 괴롭히는 사람들이 있다.",
    "가끔씩 사소한 일에 너무 신경을 쓴다.",
    "좀 더 신중하게 하지 않아 후회한 적이 있다.",
    "갚을 생각이 없으면서 돈을 빌린 적이 있다.",
    "사람들에게 지시하는 일이 내 적성에 맞는 것 같다.",
    "갑자기 감정이 격해진다.",
    "사람들이 내 기분을 상하게 하면 그냥 지나칠 수 없다.",
    "늘 몸이 개운치 않다.",
    "걱정이 너무 많아서 어떨 때는 실신할 것 같은 느낌이 든다.",
    "다른 일에 대해 생각하는 중에도 과거의 어떤 기억이 떠올라서 성가시다.",
    "기력이 거의 없다.",
    "내가 하고자 하는 일을 누군가가 방해하면 몹시 짜증이 난다.",
    "대체로 사람들은 나를 공정하게 대해 준다.",
    "내 생각은 너무 혼란스럽다.",
    "나는 내 감정을 잘 표현하는 편이다.",
    "내 의견이 무시될 때 크게 상처받는다.",
    "나는 친구를 사귀기 어렵다.",
    "새로운 일을 시작하기 전에 매우 불안해진다.",
    "나는 가끔 내가 누구인지 모르겠다.",
    "나는 종종 꿈에서 무서운 장면을 본다.",
    "나는 큰 소리를 듣는 것이 싫다.",
    "나는 내 주변의 모든 것을 통제하고 싶어 한다.",
    "나는 내가 속한 집단의 규칙을 잘 따르지 않는다.",
    "나는 나를 좋아하는 사람이 거의 없다고 생각한다.",
    "나는 종종 혼자 시간을 보내고 싶다.",
    "나는 여러 가지 문제로 인해 잠을 잘 이루지 못한다.",
    "나는 과거에 대한 후회가 많다.",
    "나는 종종 다른 사람들의 시선을 의식한다.",
    "나는 다른 사람들이 내게 기대하는 역할을 잘 수행하지 못한다.",
    "나는 내가 할 수 없는 일을 요구받을 때 좌절감을 느낀다.",
    "나는 일상 생활에서 반복적인 일들을 피하려고 한다.",
    "나는 사소한 일에 쉽게 화가 난다.",
    "나는 다른 사람들보다 더 민감한 편이다.",
    "나는 종종 다른 사람들과의 관계에서 불안을 느낀다.",
    "나는 가끔 내가 실제로 존재하지 않는 것 같은 기분이 든다.",
    "나는 다른 사람들의 기대에 부응하는 것이 어렵다고 느낀다.",
    "나는 가끔 감정적으로 무기력한 상태가 된다.",
    "나는 내 자신의 가치를 제대로 평가하지 못하는 것 같다.",
    "나는 내가 어떻게 느끼고 있는지 이해하지 못할 때가 많다.",
    "나는 종종 사람들과의 대화를 피한다.",
    "나는 종종 과거의 실수에 대해 생각한다.",
    "나는 내 건강에 대해 과도하게 걱정한다.",
    "나는 내 외모에 대해 만족하지 않는다.",
    "나는 다른 사람들에게 인정받고 싶어 한다.",
    "나는 내 감정을 숨기는 편이다.",
    "나는 감정적으로 불안정하다고 느낄 때가 많다.",
    "나는 종종 나의 능력을 과소평가한다.",
    "나는 종종 다른 사람들과의 경쟁에서 실패한다.",
    "나는 내 자신의 행동에 대해 부끄러움을 느낀다.",
    "나는 가끔 내가 누구인지 이해하지 못하는 느낌이 든다.",
    "나는 내 자신에게 과도한 요구를 한다.",
    "나는 종종 과거의 실수에 대해 후회한다.",
    "나는 내 자신을 비판하는 편이다.",
    "나는 다른 사람들의 비판을 쉽게 받아들이지 못한다.",
    "나는 종종 혼자 있는 것이 편하다.",
    "나는 내 감정을 조절하는 것이 어렵다.",
    "나는 종종 다른 사람들과의 관계에서 불편함을 느낀다.",
    "나는 내 자신의 결점에 대해 과도하게 생각한다.",
    "나는 종종 내 자신에게 실망한다.",
    "나는 종종 다른 사람들과의 대화에서 불안해진다.",
    "나는 종종 내가 틀렸다고 느낀다.",
    "나는 내 자신의 능력에 대해 의심한다.",
    "나는 종종 내 자신의 결정을 후회한다.",
    "나는 종종 내 자신의 행동에 대해 비판적이다.",
    "나는 다른 사람들의 비판에 민감하다.",
    "나는 종종 내 자신의 약점을 인식한다.",
    "나는 종종 내 자신의 한계를 이해하지 못한다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 자신의 감정을 억누른다.",
    "나는 종종 다른 사람들에게 자신의 감정을 표현하지 않는다.",
    "나는 종종 내 감정에 대해 혼란스럽다.",
    "나는 종종 다른 사람들과의 관계에서 불안하다.",
    "나는 종종 내 자신의 감정을 이해하려고 노력한다.",
    "나는 종종 다른 사람들과의 대화에서 불안해진다.",
    "나는 종종 내 자신의 능력을 의심한다.",
    "나는 종종 다른 사람들과의 관계에서 좌절감을 느낀다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 표현하는 것이 어렵다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 다른 사람들과의 관계에서 불안해진다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 자신의 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안하다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안해진다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안하다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안해진다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안하다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안해진다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안하다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안해진다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안하다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안해진다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안하다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안해진다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안하다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안해진다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안하다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안해진다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안하다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안해진다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안하다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안해진다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안하다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안해진다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안하다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안해진다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안해진다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안하다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안해진다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안하다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안해진다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안하다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안해진다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안하다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안해진다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안하다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다.",
    "나는 종종 다른 사람들과의 관계에서 불안해진다.",
    "나는 종종 내 자신의 감정을 이해하지 못한다.",
    "나는 종종 내 감정을 억누른다.",
    "나는 종종 내 감정을 표현하지 않는다."
]

# 질문을 화면에 표시하고 사용자의 답변을 수집하는 함수
def display_questions(questions):
    user_answers = []
    for i, question in enumerate(questions):
        if question:  # 질문이 있는 경우에만 표시
            # 질문과 답변을 한 줄로 표시하고, 글씨 크기를 키움
            st.markdown(f"<div style='font-size: 18px; margin-bottom: 5px;'><strong>{i + 1}. {question}</strong></div>", unsafe_allow_html=True)
            
            # 질문과 답변을 같은 줄에 표시
            answer = st.radio(
                label=" ",
                options=['전혀 아니다', '아니다', '보통이다', '그렇다', '매우 그렇다'],  # 답변 옵션
                key=f"q{i}",  # Streamlit 상태 관리를 위한 고유 키
                horizontal=True  # 가로로 배치
            )
            user_answers.append(answer)  # 사용자의 답변을 리스트에 추가

            # 각 문항과 답변 사이의 간격 조정
            st.write("---")  

    return user_answers

# 사용자의 답변을 분석하고 결과를 반환하는 함수
def analyze_results(answers):
    # 모든 답변을 하나의 문자열로 결합하여 GPT 분석에 사용
    answers_str = "\n".join(answers)

    # OpenAI API를 사용하여 성격 분석 요청
    response = openai.ChatCompletion.create(
        model="gpt-4o",
        messages=[
            {"role": "system", "content": "당신은 한국어로 성격 테스트를 분석하는 심리학자입니다."},
            {"role": "user", "content":f"다음 답변을 바탕으로:\n{answers_str}\n한국어로 상세한 성격 분석을 장문의 글로 분석내용을 작성하고 사용자가 만족할수 있는 분석을 제공하세요.   제공해 주세요. 성격 유형, 주요 특징, 강점, 약점, 추천 직업, 개선할 점, 그 외 저명한 심리학자로서 사용자에게 자세한 피드백을 제공해 주세요. "}
        ]
    )
    
    return response.choices[0].message['content']  # 분석 결과 반환

# 메인 함수
def main():
    st.set_page_config(page_title="PAI-A 청소년 성격평가", layout="wide")
    st.title("PAI-A 청소년 성격평가")  # 앱 제목

    # 설명 텍스트 추가
    st.write("### 아래 각 질문에 대해 가장 적절한 답변을 선택하세요. 모든 질문에 답한 후, 분석 버튼을 클릭하면 성격 분석 결과가 표시됩니다.")

    # 모든 질문을 표시하고 사용자의 답변 수집
    user_answers = display_questions(questions)

    # 결과 분석 버튼
    if st.button('결과 분석'):
        with st.spinner("결과를 분석 중입니다..."):
            analysis = analyze_results(user_answers)  # 분석 결과 가져오기
            st.write("### 성격 분석 결과")
            st.write(analysis)  # 분석 결과 출력

# 메인 함수 실행
if __name__ == "__main__":
    main()
